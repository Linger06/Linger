@page "/Dashboard"
@using Linger.HttpClient.Contracts.Core
@using Linger.HttpClient.Contracts.Extensions
@attribute [Authorize]
@inject IHttpClient httpClient
@inject ISnackbar Snackbar
<MudText Typo="Typo.h3" Class="mb-4">仪表盘</MudText>

<MudGrid>
    <MudItem xs="12" sm="6" md="4">
        <MudPaper Class="pa-4">
            <MudText Typo="Typo.h5">欢迎使用 Linger 应用</MudText>
            <MudText Typo="Typo.body1">这是一个使用 Blazor 组件库的示例应用</MudText>
        </MudPaper>
    </MudItem>
    <MudItem xs="12" sm="6" md="4">
        <MudPaper Class="pa-4">
            <MudText Typo="Typo.h5">数据统计</MudText>
            @if (loading)
            {
                <MudProgressCircular Indeterminate="true" />
            }
            else
            {
                <MudText Typo="Typo.body1">已加载数据项: @dataCount</MudText>
            }
        </MudPaper>
    </MudItem>
</MudGrid>

@code {
    private bool loading = true;
    private int dataCount = 0;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            // 直接反序列化为int，而不是object
            var data = await httpClient.GetAsync<int>("api/data/count");
            dataCount = data.Data;
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Dashboard错误详情: {ex}");
            Snackbar.Add($"获取数据失败: {ex.Message}", Severity.Error);
        }
        finally
        {
            loading = false;
        }
    }
}